# Project Roof - Интеграция с Битрикс24
Этот файл `README.md` включает ключевую информацию, структуру проекта и инструкции по настройке и использованию.
## Описание проекта

Этот проект представляет собой интеграцию с CRM-системой Битрикс24. Основная цель — автоматическое создание сделок на основе данных, поступающих из формы обратной связи, и привязка их к существующим или новым контактам в Битрикс24.

Форма обратной связи принимает данные от пользователя, включая имя, email, телефон, тему обращения, приоритет и сообщение. Эти данные отправляются на сервер, где:
1. Ищется контакт в Битрикс24 по email или номеру телефона.
2. Если контакт не найден, создается новый.
3. На основе контакта создается сделка.
4. Устанавливается приоритет сделки.

## Структура проекта

Проект состоит из нескольких основных директорий и файлов:
project-roof
├── assets
│   ├── css             # Стили для оформления веб-страницы
│   └── js              # Скрипты для работы с клиентской частью
├── config
│   └── api_config.php  # Конфигурационный файл с вебхуком для API Bitrix24
├── lib
│   ├── Bitrix24API.php       # Основной класс для отправки запросов к API Bitrix24
│   ├── ContactService.php    # Класс для работы с контактами в Bitrix24
│   ├── DealService.php       # Класс для работы со сделками в Bitrix24
│   └── FormHandler.php       # Класс для обработки данных из формы
├── scripts
│   └── handle_form.php       # Скрипт для обработки данных из формы и взаимодействия с API
├── index.php                 # Главная страница с HTML-формой для ввода данных
└── README.md                 # Документация проекта

## Установка и настройка

1. Склонируйте репозиторий проекта.
2. Перейдите в папку `config` и откройте файл `api_config.php`. В этом файле необходимо указать URL вебхука для работы с API Bitrix24:
   ```php
   define('BITRIX24_WEBHOOK_URL', 'https://b24-vsijry.bitrix24.kz/rest/1/iqtvi855jk8by88i/');
3. Убедитесь, что у вас установлен PHP версии 8.0+ и веб-сервер для локального тестирования.

## Использование

1. Запустите локальный сервер (например, с помощью встроенного PHP-сервера):
   ```php
    php -S localhost:8000
2. Откройте в браузере http://localhost:8000/index.php, чтобы увидеть форму обратной связи.
3.	Заполните форму и отправьте её. Форма отправляет данные в скрипт scripts/handle_form.php, который обрабатывает их, создаёт или находит контакт, создаёт сделку и устанавливает приоритет.
4.	Результат выполнения будет выведен на экран (успешное создание сделки или сообщение об ошибке).

## Основные файлы и классы

### lib/Bitrix24API.php

Основной класс для отправки запросов к API Bitrix24. Этот класс инкапсулирует общую логику работы с API.

### lib/ContactService.php

Класс для поиска и создания контактов в Bitrix24. Сначала пытается найти контакт по телефону или email, и если контакт не найден, создаёт новый.

### lib/DealService.php

Класс для создания и обновления сделок. Создает сделку и обновляет поле приоритета с использованием метода crm.deal.update.

### lib/FormHandler.php

Класс для обработки данных из формы, поиска или создания контактов и сделок, а также обновления поля приоритета.

### scripts/handle_form.php

Скрипт для получения данных из формы и вызова необходимых методов из FormHandler.

## Отладка и тестирование

Для удобной отладки рекомендуется настроить Xdebug в PHP. Вывод информации об ошибках поможет при тестировании интеграции.

## Требования

	•	PHP 8.0+
	•	Битрикс24 (необходим вебхук с доступом к API)